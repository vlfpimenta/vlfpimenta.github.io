<!DOCTYPE html>
<html lang="pt-BR" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiosque Display - Socima</title>
    <!-- Carrega o Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Carrega a biblioteca de ícones de clima (Weather Icons) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/weather-icons/2.0.12/css/weather-icons.min.css">
    
    <style>
        /* Define a fonte Inter como padrão */
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Container principal para o conteúdo */
        #main-content {
            position: relative;
            z-index: 10;
            display: flex;
            flex-direction: column;
            height: 100%;
            padding: 1.5rem; /* 24px */
            gap: 1.5rem; /* 24px */
        }
        
        /* Estilo base para os "cards" */
        .info-card {
            background-color: rgba(0, 0, 0, 0.6); /* Fundo escuro semi-transparente */
            border-radius: 1rem; /* 16px */
            padding: 1.5rem; /* 24px */
            backdrop-filter: blur(10px); /* Efeito de vidro fosco */
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1); /* Borda sutil */
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37); /* Sombra suave */
        }
        
        /* Imagens de fundo para o efeito de fade */
        .bg-image {
            position: fixed; /* Cobre a tela inteira */
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            z-index: 1; /* Fica atrás do conteúdo */
            transition: opacity 1.5s ease-in-out; /* Animação de fade */
        }

        /* Estilos do Calendário */
        #calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem; /* 8px */
            text-align: center;
        }
        .calendar-day-name {
            font-size: 0.75rem; /* 12px */
            font-weight: 600;
            color: #9ca3af; /* gray-400 */
        }
        .calendar-day {
            font-size: 0.875rem; /* 14px */
            line-height: 1.75rem; /* 28px */
            width: 1.75rem; /* 28px */
            height: 1.75rem; /* 28px */
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 9999px; /* full */
        }
        .calendar-day.today {
            background-color: #3b82f6; /* blue-500 */
            color: #ffffff; /* white */
            font-weight: 700;
        }
        .calendar-day.empty {
            opacity: 0;
        }

        /* Ícone do Clima */
        #weather-icon svg {
            /* MUDANÇA: Removido width e height daqui */
            filter: drop-shadow(0 4px 10px rgba(0,0,0,0.5));
            /* Garante que o SVG se ajuste ao contêiner */
            width: 100%;
            height: 100%;
            overflow: visible; /* MUDANÇA: Força o SVG a não se cortar */
        }
        
        /* Adicionado para corrigir corte do ícone */
        #weather-icon {
            flex-shrink: 0; 
            /* MUDANÇA: Tamanho aplicado ao contêiner, não ao SVG */
            width: 6rem; /* De 5rem para 6rem */
            height: 6rem; /* De 5rem para 6rem */
            min-width: 0; /* Resetado */
            overflow: visible; /* MUDANÇA: Garante que o contêiner não corte o SVG */
        }

        /* Clima Atual (Temperatura) */
        .weather-temp {
            font-size: 3.75rem; /* 60px */
            font-weight: 700;
            line-height: 1;
        }
        
        /* Container do layout do clima - MUDANÇA */
        .weather-container {
            display: flex;
            flex-direction: row; /* Lado a lado */
            justify-content: space-between; /* Espaço entre */
            align-items: center; /* Centraliza verticalmente */
        }
        
        /* Container dos textos do clima - MUDANÇA */
        .weather-text-content {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: flex-start; /* Alinha texto à esquerda */
            gap: 0.5rem; /* 8px */
        }

        /* Ajuste da fonte da descrição do clima */
        .weather-desc {
            font-size: 1.125rem; /* 18px */
            font-weight: 500;
        }

        /* Ajuste da fonte min/max */
        .weather-range {
            font-size: 0.875rem; /* 14px */
            color: #d1d5db; /* gray-300 */
        }
        
        /* Relógio e Data */
        .clock-time {
            font-size: 3.75rem; /* 60px */
            font-weight: 700;
            line-height: 1;
        }
        .clock-date {
            font-size: 1.125rem; /* 18px */
            font-weight: 500;
            color: #d1d5db; /* gray-300 */
        }
        
        /* Lista de horários de ônibus */
        .bus-item {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            padding-top: 0.75rem; /* 12px */
            padding-bottom: 0.75rem; /* 12px */
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .bus-item:last-child {
            border-bottom: none;
        }
        .bus-time {
            font-size: 1.5rem; /* 24px */
            font-weight: 700;
            color: #ffffff;
            flex-shrink: 0;
            margin-right: 1rem; /* 16px */
        }
        .bus-line {
            font-size: 1rem; /* 16px */
            font-weight: 500;
            color: #d1d5db; /* gray-300 */
            text-align: right;
        }
        
        /* Destaque para o próximo ônibus */
        .bus-item.next-departure {
            /* Adiciona uma borda azul à esquerda */
            border-left: 4px solid #3b82f6; /* blue-500 */
            padding-left: 1rem; /* 16px */
            background-color: rgba(59, 130, 246, 0.1); /* Fundo azul sutil */
        }
        
        /* Lista de Feriados */
        .holiday-list {
            padding-left: 1rem; /* 16px */
            border-left: 1px solid rgba(255, 255, 255, 0.1);
            max-height: 240px; /* Altura máxima do calendário */
            overflow-y: auto; /* Scroll se necessário (mas tentamos evitar) */
        }
        .holiday-item {
            /* MUDANÇA: Reduzido espaçamento e fonte */
            padding-top: 0.25rem; /* 4px */
            padding-bottom: 0.25rem; /* 4px */
        }
        .holiday-date {
            font-size: 0.875rem; /* 14px */
            font-weight: 600;
            color: #ffffff;
        }
        .holiday-name {
            font-size: 0.75rem; /* 12px */
            color: #d1d5db; /* gray-300 */
        }
        

    </style>
    <!-- Importa a fonte Inter do Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body class="h-full bg-black text-white overflow-hidden">
    
    <!-- Divs de Imagem de Fundo para Efeito de Fade -->
    <!-- Movidos para fora do main-content para cobrir a tela toda -->
    <!-- MUDANÇA: Usando Picsum Photos para maior confiabilidade -->
    <div id="bg-image-1" class="bg-image" style="opacity: 1; background-image: url('https://picsum.photos/1080/1920?random=1');"></div>
    <div id="bg-image-2" class="bg-image" style="opacity: 0;"></div>

    <!-- Container principal que segura todo o conteúdo visível -->
    <div id="main-content">
        
        <!-- PARTE SUPERIOR: Relógio e Clima -->
        <div class="flex flex-row gap-6">
            
            <!-- Card: Data e Hora (Metade Esquerda) -->
            <div class="info-card w-1/2">
                <div class="flex flex-col justify-center h-full">
                    <div id="clock-time" class="clock-time text-center">--:--</div>
                    <div id="clock-date" class="clock-date text-center">--/--/----, ---</div>
                </div>
            </div>
            
            <!-- Card: Previsão do Tempo (Metade Direita) -->
            <!-- MUDANÇA: Layout alterado conforme rascunho -->
            <div class="info-card w-1/2 weather-container">
                <!-- Coluna Esquerda: Textos -->
                <div class="weather-text-content">
                    <div id="weather-temp" class="weather-temp">--°</div>
                    <div id="weather-desc" class="weather-desc">Carregando...</div>
                    <div id="weather-range" class="weather-range">Máx: --° Mín: --°</div>
                </div>
                <!-- Coluna Direita: Ícone -->
                <div id="weather-icon-container" class="flex justify-center items-center">
                    <div id="weather-icon">
                        <!-- O SVG do ícone será inserido aqui pelo JS -->
                    </div>
                </div>
            </div>
            
        </div>
        
        <!-- PARTE CENTRAL: Calendário e Feriados -->
        <div class="info-card flex flex-row">
            <!-- Coluna Esquerda: Calendário -->
            <div class="w-1/2">
                <div id="calendar-month-year" class="text-lg font-semibold text-center mb-4">
                    Carregando Calendário...
                </div>
                <div id="calendar-header" class="calendar-day-name grid grid-cols-7 gap-2 mb-2">
                    <div>D</div><div>S</div><div>T</div><div>Q</div><div>Q</div><div>S</div><div>S</div>
                </div>
                <div id="calendar-grid">
                    <!-- Dias do calendário serão inseridos aqui -->
                </div>
            </div>
            
            <!-- Coluna Direita: Feriados -->
            <div class="w-1/2 holiday-list">
                 <h3 class="text-lg font-semibold mb-2 text-center">Próximos Feriados</h3>
                 <div id="holiday-list-content">
                     <div class="text-center text-gray-400 text-sm">Carregando feriados...</div>
                     <!-- Feriados serão inseridos aqui -->
                 </div>
            </div>
        </div>
        
        <!-- PARTE INFERIOR: Horários de Ônibus -->
        <!-- Este card é flex-1 para ocupar o espaço restante -->
        <div id="bus-schedule-card" class="info-card flex-1 flex flex-col hidden">
            <h2 class="text-xl font-semibold text-center mb-4">Próximas Saídas</h2>
            <div id="bus-schedule-list" class="flex-1 overflow-y-auto">
                <!-- Horários de ônibus serão inseridos aqui -->
                <div class="text-center text-gray-400">Carregando horários...</div>
            </div>
        </div>
        
        <!-- Rodapé Fixo -->
        <footer class="text-center text-sm text-gray-400 py-2">
            Socima
        </footer>
    </div>


    <script>
        // --- CONFIGURAÇÕES ---
        const IMAGE_CHANGE_INTERVAL = 40000; // 40 segundos
        const BUS_SCHEDULE_FILE = 'horarios.txt'; // Nome do arquivo de horários
        const HOLIDAY_COUNTRY_CODE = 'BR'; // Código do país para feriados (Brasil)
        
        // --- REFERÊNCIAS DE ELEMENTOS ---
        const clockTimeEl = document.getElementById('clock-time');
        const clockDateEl = document.getElementById('clock-date');
        const weatherTempEl = document.getElementById('weather-temp');
        const weatherDescEl = document.getElementById('weather-desc');
        const weatherRangeEl = document.getElementById('weather-range');
        const weatherIconEl = document.getElementById('weather-icon');
        const calendarGridEl = document.getElementById('calendar-grid');
        const calendarMonthYearEl = document.getElementById('calendar-month-year');
        const busScheduleCardEl = document.getElementById('bus-schedule-card');
        const busScheduleListEl = document.getElementById('bus-schedule-list');
        const holidayListEl = document.getElementById('holiday-list-content');
        
        // Referências das imagens de fundo
        const bg1 = document.getElementById('bg-image-1');
        const bg2 = document.getElementById('bg-image-2');
        let currentBgToggle = true; // Controla qual div está ativa


        // --- MAPA DE CÓDIGOS DE CLIMA (WMO) ---
        // Mapeia códigos WMO para ícones Weather Icons e descrições em PT-BR
        const weatherCodes = {
            0: { desc: "Céu Limpo", icon: "wi-day-sunny" },
            1: { desc: "Quase Limpo", icon: "wi-day-sunny-overcast" },
            2: { desc: "Parcialmente Nublado", icon: "wi-day-cloudy" },
            3: { desc: "Nublado", icon: "wi-cloudy" },
            45: { desc: "Nevoeiro", icon: "wi-fog" },
            48: { desc: "Nevoeiro Congelante", icon: "wi-fog" },
            51: { desc: "Garoa Leve", icon: "wi-sprinkle" },
            53: { desc: "Garoa Moderada", icon: "wi-sprinkle" },
            55: { desc: "Garoa Forte", icon: "wi-sprinkle" },
            56: { desc: "Garoa Congelante Leve", icon: "wi-sleet" },
            57: { desc: "Garoa Congelante Forte", icon: "wi-sleet" },
            61: { desc: "Chuva Leve", icon: "wi-rain" },
            63: { desc: "Chuva Moderada", icon: "wi-rain" },
            65: { desc: "Chuva Forte", icon: "wi-rain" },
            66: { desc: "Chuva Congelante Leve", icon: "wi-sleet" },
            67: { desc: "Chuva Congelante Forte", icon: "wi-sleet" },
            71: { desc: "Neve Leve", icon: "wi-snow" },
            73: { desc: "Neve Moderada", icon: "wi-snow" },
            75: { desc: "Neve Forte", icon: "wi-snow" },
            77: { desc: "Grãos de Neve", icon: "wi-snow" },
            80: { desc: "Aguaceiros Leves", icon: "wi-showers" },
            81: { desc: "Aguaceiros Moderados", icon: "wi-showers" },
            82: { desc: "Aguaceiros Violentos", icon: "wi-showers" },
            85: { desc: "Neve Leve", icon: "wi-snow" },
            86: { desc: "Neve Forte", icon: "wi-snow" },
            95: { desc: "Trovoada", icon: "wi-thunderstorm" },
            96: { desc: "Trovoada com Granizo Leve", icon: "wi-storm-showers" },
            99: { desc: "Trovoada com Granizo Forte", icon: "wi-storm-showers" },
        };
        
        // --- Ícones SVG (Alternativa aos Weather Icons, se necessário) ---
        // SVGs embutidos para evitar dependência externa e problemas de corte
        const svgIcons = {
            'wi-day-sunny': `<svg viewBox="0 0 30 30" style="width: 100%; height: 100%;"><path d="M15,4c-0.552,0-1-0.448-1-1V1c0-0.552,0.448-1,1-1s1,0.448,1,1v2C16,3.552,15.552,4,15,4z M15,28c-0.552,0-1,0.448-1,1v2c0,0.552,0.448,1,1,1s1-0.448,1-1v-2C16,28.448,15.552,28,15,28z M21.924,6.66l-1.414,1.414c-0.391,0.391-1.024,0.391-1.414,0s-0.391-1.024,0-1.414l1.414-1.414c0.391-0.391,1.024-0.391,1.414,0S22.314,6.269,21.924,6.66z M7.076,21.924l-1.414,1.414c-0.391,0.391-0.391,1.024,0,1.414s1.024,0.391,1.414,0l1.414-1.414c0.391-0.391,0.391-1.024,0-1.414S7.467,21.533,7.076,21.924z M28,15c0,0.552,0.448,1,1,1h2c0.552,0,1-0.448,1-1s-0.448-1-1-1h-2C28.448,14,28,14.448,28,15z M0,15c0,0.552,0.448,1,1,1h2c0.552,0,1-0.448,1-1s-0.448-1-1-1H1C0.448,14,0,14.448,0,15z M23.33,21.924c-0.391-0.391-1.024-0.391-1.414,0s-0.391,1.024,0,1.414l1.414,1.414c0.391,0.391,1.024,0.391,1.414,0s0.391-1.024,0-1.414L23.33,21.924z M5.66,7.076c-0.391-0.391-1.024-0.391-1.414,0s-0.391,1.024,0,1.414l1.414,1.414c0.391,0.391,1.024,0.391,1.414,0s0.391-1.024,0-1.414L5.66,7.076z M15,8c-3.866,0-7,3.134-7,7s3.134,7,7,7s7-3.134,7-7S18.866,8,15,8z M15,20c-2.761,0-5-2.239-5-5s2.239-5,5-5s5,2.239,5,5S17.761,20,15,20z" fill="white"></path></svg>`,
            'wi-day-cloudy': `<svg viewBox="-5 -5 40 40" style="width: 100%; height: 100%;"><path d="M25.433,10.038c-0.375-3.382-3.141-6.038-6.619-6.038c-2.61,0-4.908,1.521-6.069,3.771C11.536,7.182,10.33,7,9,7c-3.866,0-7,3.134-7,7c0,0.376,0.042,0.741,0.111,1.096C0.825,15.053,0,16.185,0,17.5C0,19.433,1.567,21,3.5,21h11.5h11.5c3.033,0,5.5-2.467,5.5-5.5C32,12.793,29.071,10.222,25.433,10.038z M23,19H3.5C2.673,19,2,18.327,2,17.5C2,16.673,2.673,16,3.5,16h0.091l0.724-0.052C4.782,12.684,6.66,10,9,10c1.77,0,3.344,0.923,4.275,2.368L13.8,13.2l0.55-0.31c1.01-0.573,2.158-0.89,3.364-0.89c2.396,0,4.449,1.72,4.86,4.02L22.75,17l0.25,0c1.921,0,3.5,1.579,3.5,3.5S24.921,24,23,24c-2.761,0-5-2.239-5-5c0-0.552,0.448-1,1-1s1,0.448,1,1c0,1.657,1.343,3,3,3c0.827,0,1.5-0.673,1.5-1.5S23.827,19,23,19z" fill="white"></path></svg>`,
            'wi-cloudy': `<svg viewBox="-5 -5 40 40" style="width: 100%; height: 100%;"><path d="M25.433,10.038c-0.375-3.382-3.141-6.038-6.619-6.038c-2.61,0-4.908,1.521-6.069,3.771C11.536,7.182,10.33,7,9,7c-3.866,0-7,3.134-7,7c0,0.376,0.042,0.741,0.111,1.096C0.825,15.053,0,16.185,0,17.5C0,19.433,1.567,21,3.5,21h11.5h11.5c3.033,0,5.5-2.467,5.5-5.5C32,12.793,29.071,10.222,25.433,10.038z M26.5,21H3.5C2.673,21,2,20.327,2,19.5C2,18.673,2.673,18,3.5,18h0.091l0.724-0.052C4.782,14.684,6.66,12,9,12c1.77,0,3.344,0.923,4.275,2.368L13.8,15.2l0.55-0.31c1.01-0.573,2.158-0.89,3.364-0.89c2.396,0,4.449,1.72,4.86,4.02L22.75,19l0.25,0h3.5C27.327,19,28,19.673,28,20.5S27.327,22,26.5,22z" fill="white"></path></svg>`,
            'wi-rain': `<svg viewBox="-5 -5 40 40" style="width: 100%; height: 100%;"><path d="M25.433,10.038c-0.375-3.382-3.141-6.038-6.619-6.038c-2.61,0-4.908,1.521-6.069,3.771C11.536,7.182,10.33,7,9,7c-3.866,0-7,3.134-7,7c0,0.376,0.042,0.741,0.111,1.096C0.825,15.053,0,16.185,0,17.5C0,19.433,1.567,21,3.5,21h11.5h11.5c3.033,0,5.5-2.467,5.5-5.5C32,12.793,29.071,10.222,25.433,10.038z M26.5,19H3.5C2.673,19,2,18.327,2,17.5C2,16.673,2.673,16,3.5,16h0.091l0.724-0.052C4.782,12.684,6.66,10,9,10c1.77,0,3.344,0.923,4.275,2.368L13.8,13.2l0.55-0.31c1.01-0.573,2.158-0.89,3.364-0.89c2.396,0,4.449,1.72,4.86,4.02L22.75,17l0.25,0h3.5C27.327,17,28,17.673,28,18.5S27.327,20,26.5,20z" fill="white"></path><path d="M11,23c-0.552,0-1,0.448-1,1v3c0,0.552,0.448,1,1,1s1-0.448,1-1v-3C12,23.448,11.552,23,11,23z M16,23c-0.552,0-1,0.448-1,1v3c0,0.552,0.448,1,1,1s1-0.448,1-1v-3C17,23.448,16.552,23,16,23z M21,23c-0.552,0-1,0.448-1,1v3c0,0.552,0.448,1,1,1s1-0.448,1-1v-3C22,23.448,21.552,23,21,23z" fill="white"></path></svg>`,
            'wi-showers': `<svg viewBox="-5 -5 40 40" style="width: 100%; height: 100%;"><path d="M25.433,10.038c-0.375-3.382-3.141-6.038-6.619-6.038c-2.61,0-4.908,1.521-6.069,3.771C11.536,7.182,10.33,7,9,7c-3.866,0-7,3.134-7,7c0,0.376,0.042,0.741,0.111,1.096C0.825,15.053,0,16.185,0,17.5C0,19.433,1.567,21,3.5,21h11.5h11.5c3.033,0,5.5-2.467,5.5-5.5C32,12.793,29.071,10.222,25.433,10.038z M26.5,19H3.5C2.673,19,2,18.327,2,17.5C2,16.673,2.673,16,3.5,16h0.091l0.724-0.052C4.782,12.684,6.66,10,9,10c1.77,0,3.344,0.923,4.275,2.368L13.8,13.2l0.55-0.31c1.01-0.573,2.158-0.89,3.364-0.89c2.396,0,4.449,1.72,4.86,4.02L22.75,17l0.25,0h3.5C27.327,17,28,17.673,28,18.5S27.327,20,26.5,20z" fill="white"></path><path d="M11,23c-0.552,0-1,0.448-1,1v3c0,0.552,0.448,1,1,1s1-0.448,1-1v-3C12,23.448,11.552,23,11,23z M16,23c-0.552,0-1,0.448-1,1v3c0,0.552,0.448,1,1,1s1-0.448,1-1v-3C17,23.448,16.552,23,16,23z" fill="white"></path></svg>`,
            'wi-fog': `<svg viewBox="-5 -5 40 40" style="width: 100%; height: 100%;"><path d="M25.433,10.038c-0.375-3.382-3.141-6.038-6.619-6.038c-2.61,0-4.908,1.521-6.069,3.771C11.536,7.182,10.33,7,9,7c-3.866,0-7,3.134-7,7c0,0.376,0.042,0.741,0.111,1.096C0.825,15.053,0,16.185,0,17.5C0,19.433,1.567,21,3.5,21h23c3.033,0,5.5-2.467,5.5-5.5C32,12.793,29.071,10.222,25.433,10.038z M26.5,19H3.5C2.673,19,2,18.327,2,17.5C2,16.673,2.673,16,3.5,16h0.091l0.724-0.052C4.782,12.684,6.66,10,9,10c1.77,0,3.344,0.923,4.275,2.368L13.8,13.2l0.55-0.31c1.01-0.573,2.158-0.89,3.364-0.89c2.396,0,4.449,1.72,4.86,4.02L22.75,17l0.25,0h3.5C27.327,17,28,17.673,28,18.5S27.327,20,26.5,20z" fill="white"></path><path d="M5,23c-0.552,0-1,0.448-1,1s0.448,1,1,1h22c0.552,0,1-0.448,1-1s-0.448-1-1-1H5z M3,27c-0.552,0-1,0.448-1,1s0.448,1,1,1h26c0.552,0,1-0.448,1-1s-0.448-1-1-1H3z" fill="white"></path></svg>`,
            'wi-snow': `<svg viewBox="-5 -5 40 40" style="width: 100%; height: 100%;"><path d="M25.433,10.038c-0.375-3.382-3.141-6.038-6.619-6.038c-2.61,0-4.908,1.521-6.069,3.771C11.536,7.182,10.33,7,9,7c-3.866,0-7,3.134-7,7c0,0.376,0.042,0.741,0.111,1.096C0.825,15.053,0,16.185,0,17.5C0,19.433,1.567,21,3.5,21h11.5h11.5c3.033,0,5.5-2.467,5.5-5.5C32,12.793,29.071,10.222,25.433,10.038z M26.5,19H3.5C2.673,19,2,18.327,2,17.5C2,16.673,2.673,16,3.5,16h0.091l0.724-0.052C4.782,12.684,6.66,10,9,10c1.77,0,3.344,0.923,4.275,2.368L13.8,13.2l0.55-0.31c1.01-0.573,2.158-0.89,3.364-0.89c2.396,0,4.449,1.72,4.86,4.02L22.75,17l0.25,0h3.5C27.327,17,28,17.673,28,18.5S27.327,20,26.5,20z" fill="white"></path><path d="M11.333,23.333c-0.256,0-0.512-0.098-0.707-0.293c-0.391-0.391-0.391-1.024,0-1.414l1.667-1.667c0.391-0.391,1.024-0.391,1.414,0s0.391,1.024,0,1.414l-1.667,1.667C11.845,23.236,11.589,23.333,11.333,23.333z M16,23c-0.552,0-1,0.448-1,1v2c0,0.552,0.448,1,1,1s1-0.448,1-1v-2C17,23.448,16.552,23,16,23z M19.253,22.747c-0.391-0.391-0.391-1.024,0-1.414l1.667-1.667c0.391-0.391,1.024-0.391,1.414,0s0.391,1.024,0,1.414l-1.667,1.667C20.277,23.138,19.643,23.138,19.253,22.747z M9.919,26.747c-0.391-0.391-0.391-1.024,0-1.414l1.667-1.667c0.391-0.391,1.024-0.391,1.414,0s0.391,1.024,0,1.414l-1.667,1.667C10.943,27.138,10.309,27.138,9.919,26.747z M20.667,28.333c-0.256,0-0.512-0.098-0.707-0.293c-0.391-0.391-0.391-1.024,0-1.414l1.667-1.667c0.391-0.391,1.024-0.391,1.414,0s0.391,1.024,0,1.414l-1.667,1.667C21.179,28.236,20.923,28.333,20.667,28.333z" fill="white"></path></svg>`,
            'wi-sleet': `<svg viewBox="-5 -5 40 40" style="width: 100%; height: 100%;"><path d="M25.433,10.038c-0.375-3.382-3.141-6.038-6.619-6.038c-2.61,0-4.908,1.521-6.069,3.771C11.536,7.182,10.33,7,9,7c-3.866,0-7,3.134-7,7c0,0.376,0.042,0.741,0.111,1.096C0.825,15.053,0,16.185,0,17.5C0,19.433,1.567,21,3.5,21h11.5h11.5c3.033,0,5.5-2.467,5.5-5.5C32,12.793,29.071,10.222,25.433,10.038z M26.5,19H3.5C2.673,19,2,18.327,2,17.5C2,16.673,2.673,16,3.5,16h0.091l0.724-0.052C4.782,12.684,6.66,10,9,10c1.77,0,3.344,0.923,4.275,2.368L13.8,13.2l0.55-0.31c1.01-0.573,2.158-0.89,3.364-0.89c2.396,0,4.449,1.72,4.86,4.02L22.75,17l0.25,0h3.5C27.327,17,28,17.673,28,18.5S27.327,20,26.5,20z" fill="white"></path><path d="M11,23c-0.552,0-1,0.448-1,1v3c0,0.552,0.448,1,1,1s1-0.448,1-1v-3C12,23.448,11.552,23,11,23z M16,23c-0.552,0-1,0.448-1,1v3c0,0.552,0.448,1,1,1s1-0.448,1-1v-3C17,23.448,16.552,23,16,23z M21,23c-0.552,0-1,0.448-1,1v3c0,0.552,0.448,1,1,1s1-0.448,1-1v-3C22,23.448,21.552,23,21,23z" fill="white"></path></svg>`,
            'wi-sprinkle': `<svg viewBox="-5 -5 40 40" style="width: 100%; height: 100%;"><path d="M25.433,10.038c-0.375-3.382-3.141-6.038-6.619-6.038c-2.61,0-4.908,1.521-6.069,3.771C11.536,7.182,10.33,7,9,7c-3.866,0-7,3.134-7,7c0,0.376,0.042,0.741,0.111,1.096C0.825,15.053,0,16.185,0,17.5C0,19.433,1.567,21,3.5,21h11.5h11.5c3.033,0,5.5-2.467,5.5-5.5C32,12.793,29.071,10.222,25.433,10.038z M26.5,19H3.5C2.673,19,2,18.327,2,17.5C2,16.673,2.673,16,3.5,16h0.091l0.724-0.052C4.782,12.684,6.66,10,9,10c1.77,0,3.344,0.923,4.275,2.368L13.8,13.2l0.55-0.31c1.01-0.573,2.158-0.89,3.364-0.89c2.396,0,4.449,1.72,4.86,4.02L22.75,17l0.25,0h3.5C27.327,17,28,17.673,28,18.5S27.327,20,26.5,20z" fill="white"></path><path d="M11,23c-0.552,0-1,0.448-1,1v1c0,0.552,0.448,1,1,1s1-0.448,1-1v-1C12,23.448,11.552,23,11,23z M16,23c-0.552,0-1,0.448-1,1v1c0,0.552,0.448,1,1,1s1-0.448,1-1v-1C17,23.448,16.552,23,16,23z M21,23c-0.552,0-1,0.448-1,1v1c0,0.552,0.448,1,1,1s1-0.448,1-1v-1C22,23.448,21.552,23,21,23z" fill="white"></path></svg>`,
            'wi-thunderstorm': `<svg viewBox="-5 -5 40 40" style="width: 100%; height: 100%;"><path d="M25.433,10.038c-0.375-3.382-3.141-6.038-6.619-6.038c-2.61,0-4.908,1.521-6.069,3.771C11.536,7.182,10.33,7,9,7c-3.866,0-7,3.134-7,7c0,0.376,0.042,0.741,0.111,1.096C0.825,15.053,0,16.185,0,17.5C0,19.433,1.567,21,3.5,21h11.5h11.5c3.033,0,5.5-2.467,5.5-5.5C32,12.793,29.071,10.222,25.433,10.038z M26.5,19H3.5C2.673,19,2,18.327,2,17.5C2,16.673,2.673,16,3.5,16h0.091l0.724-0.052C4.782,12.684,6.66,10,9,10c1.77,0,3.344,0.923,4.275,2.368L13.8,13.2l0.55-0.31c1.01-0.573,2.158-0.89,3.364-0.89c2.396,0,4.449,1.72,4.86,4.02L22.75,17l0.25,0h3.5C27.327,17,28,17.673,28,18.5S27.327,20,26.5,20z" fill="white"></path><path d="M13.268,22.373c-0.354-0.198-0.78-0.07-1.008,0.255l-3,5C8.981,28.18,9.086,28.761,9.44,29.04s0.811,0.176,1.145-0.111l4-5c0.228-0.325,0.228-0.762,0-1.087l-1-1.5C13.407,22.091,13.111,22.031,12.827,22.127z" fill="white"></path><path d="M20.268,22.373c-0.354-0.198-0.78-0.07-1.008,0.255l-3,5C15.981,28.18,16.086,28.761,16.44,29.04s0.811,0.176,1.145-0.111l4-5c0.228-0.325,0.228-0.762,0-1.087l-1-1.5C20.407,22.091,20.111,22.031,19.827,22.127z" fill="white"></path></svg>`,
            'wi-storm-showers': `<svg viewBox="-5 -5 40 40" style="width: 100%; height: 100%;"><path d="M25.433,10.038c-0.375-3.382-3.141-6.038-6.619-6.038c-2.61,0-4.908,1.521-6.069,3.771C11.536,7.182,10.33,7,9,7c-3.866,0-7,3.134-7,7c0,0.376,0.042,0.741,0.111,1.096C0.825,15.053,0,16.185,0,17.5C0,19.433,1.567,21,3.5,21h11.5h11.5c3.033,0,5.5-2.467,5.5-5.5C32,12.793,29.071,10.222,25.433,10.038z M26.5,19H3.5C2.673,19,2,18.327,2,17.5C2,16.673,2.673,16,3.5,16h0.091l0.724-0.052C4.782,12.684,6.66,10,9,10c1.77,0,3.344,0.923,4.275,2.368L13.8,13.2l0.55-0.31c1.01-0.573,2.158-0.89,3.364-0.89c2.396,0,4.449,1.72,4.86,4.02L22.75,17l0.25,0h3.5C27.327,17,28,17.673,28,18.5S27.327,20,26.5,20z" fill="white"></path><path d="M11.333,23.333c-0.256,0-0.512-0.098-0.707-0.293c-0.391-0.391-0.391-1.024,0-1.414l1.667-1.667c0.391-0.391,1.024-0.391,1.414,0s0.391,1.024,0,1.414l-1.667,1.667C11.845,23.236,11.589,23.333,11.333,23.333z M9.919,26.747c-0.391-0.391-0.391-1.024,0-1.414l1.667-1.667c0.391-0.391,1.024-0.391,1.414,0s0.391,1.024,0,1.414l-1.667,1.667C10.943,27.138,10.309,27.138,9.919,26.747z M13.268,22.373c-0.354-0.198-0.78-0.07-1.008,0.255l-3,5C8.981,28.18,9.086,28.761,9.44,29.04s0.811,0.176,1.145-0.111l4-5c0.228-0.325,0.228-0.762,0-1.087l-1-1.5C13.407,22.091,13.111,22.031,12.827,22.127z" fill="white"></path><path d="M18,23c-0.552,0-1,0.448-1,1v3c0,0.552,0.448,1,1,1s1-0.448,1-1v-3C19,23.448,18.552,23,18,23z M23,23c-0.552,0-1,0.448-1,1v3c0,0.552,0.448,1,1,1s1-0.448,1-1v-3C24,23.448,23.552,23,23,23z" fill="white"></path></svg>`
            // Adicione outros ícones conforme necessário
        };
        
        // --- FUNÇÕES DE ATUALIZAÇÃO ---

        /**
         * Atualiza o relógio e a data
         */
        function updateClock() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            
            // Formata a data (ex: 06/11/2025, Quinta-feira)
            const options = { weekday: 'long', year: 'numeric', month: 'numeric', day: 'numeric' };
            let dateString = now.toLocaleDateString('pt-BR', options);
            // Capitaliza o dia da semana
            dateString = dateString.charAt(0).toUpperCase() + dateString.slice(1);
            
            clockTimeEl.textContent = `${hours}:${minutes}`;
            clockDateEl.textContent = dateString;
        }

        /**
         * Busca a localização do usuário e, em seguida, a previsão do tempo.
         */
        function fetchWeather() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(position => {
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;
                    getWeatherData(lat, lon);
                }, () => {
                    // Falha na geolocalização, usa São Paulo como padrão
                    getWeatherData(-23.55, -46.63);
                });
            } else {
                // Navegador não suporta geolocalização, usa São Paulo
                getWeatherData(-23.55, -46.63);
            }
        }

        /**
         * Busca dados da API Open-Meteo com base na latitude e longitude.
         */
        async function getWeatherData(lat, lon) {
            try {
                const apiUrl = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&daily=temperature_2m_max,temperature_2m_min&timezone=auto`;
                const response = await fetch(apiUrl);
                if (!response.ok) throw new Error('Falha ao buscar clima');
                
                const data = await response.json();
                
                const current = data.current_weather;
                const daily = data.daily;
                
                // Mapeia o código WMO para nossa descrição e ícone
                const weatherInfo = weatherCodes[current.weathercode] || { desc: "Indefinido", icon: "wi-na" };
                
                weatherTempEl.textContent = `${Math.round(current.temperature)}°`;
                weatherDescEl.textContent = weatherInfo.desc;
                weatherRangeEl.textContent = `Máx: ${Math.round(daily.temperature_2m_max[0])}° Mín: ${Math.round(daily.temperature_2m_min[0])}°`;
                
                // Insere o Ícone SVG no contêiner
                weatherIconEl.innerHTML = svgIcons[weatherInfo.icon] || svgIcons['wi-cloudy']; // Padrão para nublado se ícone faltar

            } catch (error) {
                console.error("Erro ao buscar clima:", error);
                weatherDescEl.textContent = "Erro no clima";
            }
        }

        /**
         * Atualiza o calendário para o mês atual.
         */
        function updateCalendar() {
            const now = new Date();
            const year = now.getFullYear();
            const month = now.getMonth(); // 0-11
            const today = now.getDate();

            // Nome do mês e ano (ex: Novembro 2025)
            const monthYearString = now.toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' });
            calendarMonthYearEl.textContent = monthYearString.charAt(0).toUpperCase() + monthYearString.slice(1);

            // Limpa o grid
            calendarGridEl.innerHTML = '';

            // Encontra o primeiro dia do mês (0=Dom, 1=Seg, ...)
            const firstDayOfMonth = new Date(year, month, 1).getDay();
            // Encontra o último dia do mês
            const daysInMonth = new Date(year, month + 1, 0).getDate();

            // 1. Adiciona células vazias para os dias antes do dia 1
            for (let i = 0; i < firstDayOfMonth; i++) {
                const emptyCell = document.createElement('div');
                emptyCell.classList.add('calendar-day', 'empty');
                calendarGridEl.appendChild(emptyCell);
            }

            // 2. Adiciona os dias do mês
            for (let day = 1; day <= daysInMonth; day++) {
                const dayCell = document.createElement('div');
                dayCell.classList.add('calendar-day');
                dayCell.textContent = day;
                
                // Destaca o dia de hoje
                if (day === today) {
                    dayCell.classList.add('today');
                }
                
                calendarGridEl.appendChild(dayCell);
            }
        }
        
        /**
         * Busca e processa a lista de feriados.
         */
        async function fetchHolidays() {
            const year = new Date().getFullYear();
            const apiUrl = `https://date.nager.at/api/v3/NextPublicHolidays/${HOLIDAY_COUNTRY_CODE}`;
            
            try {
                const response = await fetch(apiUrl);
                if (!response.ok) throw new Error('Falha ao buscar feriados');
                
                const holidays = await response.json();
                
                holidayListEl.innerHTML = ''; // Limpa o estado "carregando"
                
                if (holidays.length === 0) {
                     holidayListEl.innerHTML = '<div class="text-gray-400 text-sm">Nenhum feriado próximo.</div>';
                     return;
                }
                
                // Pega os próximos 4 feriados
                const nextHolidays = holidays.slice(0, 4);
                
                const formatter = new Intl.DateTimeFormat('pt-BR', { day: 'numeric', month: 'short' });
                
                nextHolidays.forEach(holiday => {
                    const holidayDate = new Date(holiday.date);
                    const dateString = formatter.format(holidayDate).replace('.', ''); // Remove ponto (ex: 6 de nov)
                    
                    const item = document.createElement('div');
                    item.classList.add('holiday-item');
                    item.innerHTML = `
                        <div class="holiday-date">${dateString}</div>
                        <div class="holiday-name">${holiday.localName}</div>
                    `;
                    holidayListEl.appendChild(item);
                });
                
            } catch (error) {
                console.error("Erro ao buscar feriados:", error);
                holidayListEl.innerHTML = '<div class="text-gray-400 text-sm">Erro ao carregar feriados.</div>';
            }
        }
        

        /**
         * Busca e processa a lista de horários de ônibus.
         */
        async function fetchBusSchedule() {
            try {
                const response = await fetch(BUS_SCHEDULE_FILE);
                if (!response.ok) {
                    // Se o arquivo não existir (404), simplesmente não faz nada.
                    // O card permanecerá oculto (hidden).
                    throw new Error('Arquivo de horários não encontrado.');
                }
                
                const data = await response.text();
                const lines = data.split('\n').filter(line => line.trim() !== '');
                
                if (lines.length === 0) {
                    // Arquivo existe, mas está vazio. Não mostra o card.
                    return;
                }
                
                // Processa as linhas no formato "HH:MM=Linha"
                const schedule = lines.map(line => {
                    const parts = line.split('=');
                    if (parts.length !== 2) return null;
                    return { time: parts[0].trim(), line: parts[1].trim() };
                }).filter(item => item !== null && item.time.match(/^\d{2}:\d{2}$/)); // Valida o formato HH:MM
                
                if (schedule.length > 0) {
                    // Se temos horários válidos, mostra o card
                    busScheduleCardEl.classList.remove('hidden');
                    updateBusSchedule(schedule);
                }

            } catch (error) {
                console.warn(error.message);
                // Mantém o card oculto se houver qualquer erro
            }
        }
        
        /**
         * Atualiza a exibição da lista de ônibus com base nos horários carregados.
         */
        function updateBusSchedule(schedule) {
            const now = new Date();
            const currentTime = String(now.getHours()).padStart(2, '0') + ':' + String(now.getMinutes()).padStart(2, '0');

            // 1. Filtra apenas os horários futuros
            const upcoming = schedule.filter(item => item.time > currentTime);

            // 2. Pega os próximos 3 (ou menos, se não houver 3)
            const nextDepartures = upcoming.slice(0, 3);
            
            busScheduleListEl.innerHTML = ''; // Limpa a lista

            if (nextDepartures.length === 0) {
                busScheduleListEl.innerHTML = '<div class="text-center text-gray-400">Não há mais saídas programadas para hoje.</div>';
                return;
            }

            // 3. Exibe os horários
            nextDepartures.forEach((item, index) => {
                const itemEl = document.createElement('div');
                itemEl.classList.add('bus-item');
                
                // Destaca o primeiro item da lista (a saída mais próxima)
                if (index === 0) {
                    itemEl.classList.add('next-departure');
                }
                
                itemEl.innerHTML = `
                    <span class="bus-time">${item.time}</span>
                    <span class="bus-line">${item.line}</span>
                `;
                busScheduleListEl.appendChild(itemEl);
            });
        }
        

        /**
         * Busca uma nova imagem aleatória e faz o cross-fade.
         */
        function updateBackground() {
            // MUDANÇA: Usando Picsum Photos para maior confiabilidade
            // Adiciona um timestamp para evitar o cache
            const randomImageUrl = `https://picsum.photos/1080/1920?random=${new Date().getTime()}`;
            
            // Determina qual div está "ativa" e qual está "oculta"
            const activeBg = currentBgToggle ? bg1 : bg2;
            const hiddenBg = currentBgToggle ? bg2 : bg1;
            
            // 1. Define a nova imagem na div oculta
            hiddenBg.style.backgroundImage = `url(${randomImageUrl})`;
            
            // 2. Inicia a transição
            activeBg.style.opacity = 0;
            hiddenBg.style.opacity = 1;
            
            // 3. Inverte o controle
            currentBgToggle = !currentBgToggle;
        }

        // --- INICIALIZAÇÃO ---
        function init() {
            // Atualiza tudo imediatamente
            updateClock();
            fetchWeather();
            updateCalendar();
            fetchHolidays();
            fetchBusSchedule(); // Tenta buscar os horários
            
            // Configura os intervalos de atualização
            setInterval(updateClock, 1000); // Relógio a cada segundo
            setInterval(fetchWeather, 600000); // Clima a cada 10 minutos
            setInterval(fetchBusSchedule, 30000); // Horários de ônibus a cada 30 segundos
            setInterval(updateBackground, IMAGE_CHANGE_INTERVAL); // Imagem de fundo
            
            // Atualiza o calendário e feriados uma vez por hora (caso passe da meia-noite)
            setInterval(() => {
                updateCalendar();
                fetchHolidays();
            }, 3600000);
        }

        // Inicia o script quando a página carregar
        document.addEventListener('DOMContentLoaded', init);
    </script>

</body>
</html>
